<div class="space-y-6">
  <div class="flex justify-between items-center">
    <div>
      <h1 class="text-3xl font-bold text-gray-900">User Report</h1>
      <p class="mt-2 text-gray-600">Total Users: <span class="font-bold text-gray-900"><%= @total_users %></span></p>
    </div>
    <%= link_to "← Back to Reports", admin_reports_path, class: "text-purple-600 hover:text-purple-700 font-medium" %>
  </div>

  <!-- Users by Plan Summary -->
  <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
    <% { free: "Free", basic: "Basic", pro: "Pro" }.each do |plan, label| %>
      <div class="bg-white rounded-lg shadow p-4">
        <p class="text-sm font-medium text-gray-600"><%= label %> Plan</p>
        <p class="text-2xl font-bold text-gray-900 mt-1"><%= @users_by_plan[plan.to_s]&.count || 0 %></p>
      </div>
    <% end %>
  </div>

  <!-- Users Table -->
  <div class="bg-white rounded-lg shadow overflow-hidden">
    <div class="overflow-x-auto">
      <table class="w-full">
        <thead class="bg-gray-50 border-b">
          <tr>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">User</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">Email</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">Phone</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">Plan</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">Credentials</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">Actions</th>
          </tr>
        </thead>
        <tbody class="divide-y">
          <% @users.each do |user| %>
            <tr class="hover:bg-gray-50 transition">
              <td class="px-6 py-4 whitespace-nowrap">
                <div>
                  <p class="font-medium text-gray-900"><%= user.full_name %></p>
                  <p class="text-sm text-gray-500"><%= user.role.capitalize %></p>
                </div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600"><%= user.email %></td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600"><%= user.phone || "—" %></td>
              <td class="px-6 py-4 whitespace-nowrap">
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium
                  <% case user.plan %>
                    <% when "free" %>
                      bg-gray-100 text-gray-800
                    <% when "basic" %>
                      bg-blue-100 text-blue-800
                    <% when "pro" %>
                      bg-purple-100 text-purple-800
                  <% end %>
                ">
                  <%= user.plan.capitalize %>
                </span>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <%= link_to user.credentials.count, admin_credentials_path(user_id: user.id), class: "text-purple-600 hover:text-purple-700 font-medium" %>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm space-x-2">
                <%= link_to "Reset Password", admin_user_send_password_reset_path(user), method: :post,
                    data: { confirm: "Send password reset email to #{user.email}?" },
                    class: "inline-flex items-center px-3 py-1 bg-orange-100 text-orange-700 rounded hover:bg-orange-200 transition font-medium text-xs" %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>

  <% if @users.empty? %>
    <div class="text-center py-12">
      <p class="text-gray-600">No users found</p>
    </div>
  <% end %>
</div>

<script>
  // Handle password reset button
  document.querySelectorAll('a[data-confirm]').forEach(link => {
    link.addEventListener('click', (e) => {
      if (!confirm(link.getAttribute('data-confirm'))) {
        e.preventDefault();
      }
    });
  });
</script>
