<div class="space-y-8">
  <div class="flex justify-between items-center">
    <div>
      <h1 class="text-3xl font-bold text-gray-900">LLM Usage Report</h1>
      <p class="mt-2 text-gray-600">Analytics and breakdown of AI model usage and costs</p>
    </div>
    <%= link_to "â† Back to Reports", admin_reports_path, class: "text-purple-600 hover:text-purple-700 font-medium" %>
  </div>

  <!-- Summary Statistics -->
  <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
    <div class="bg-gradient-to-br from-blue-50 to-blue-100 rounded-lg shadow p-6 border border-blue-200">
      <p class="text-sm font-medium text-blue-700">Total Requests</p>
      <p class="text-3xl font-bold text-blue-900 mt-2"><%= @total_requests %></p>
    </div>

    <div class="bg-gradient-to-br from-purple-50 to-purple-100 rounded-lg shadow p-6 border border-purple-200">
      <p class="text-sm font-medium text-purple-700">Total Tokens</p>
      <p class="text-3xl font-bold text-purple-900 mt-2"><%= number_with_delimiter(@total_tokens) %></p>
    </div>

    <div class="bg-gradient-to-br from-green-50 to-green-100 rounded-lg shadow p-6 border border-green-200">
      <p class="text-sm font-medium text-green-700">Total Cost</p>
      <p class="text-3xl font-bold text-green-900 mt-2">$<%= "%.2f" % @total_cost %></p>
    </div>

    <div class="bg-gradient-to-br from-orange-50 to-orange-100 rounded-lg shadow p-6 border border-orange-200">
      <p class="text-sm font-medium text-orange-700">Avg Cost / Request</p>
      <p class="text-3xl font-bold text-orange-900 mt-2">$<%= "%.4f" % (@total_requests > 0 ? @total_cost / @total_requests : 0) %></p>
    </div>
  </div>

  <!-- Usage by User -->
  <div class="bg-white rounded-lg shadow overflow-hidden">
    <div class="px-6 py-4 border-b bg-gray-50">
      <h2 class="text-xl font-bold text-gray-900">Usage by User</h2>
    </div>
    <div class="overflow-x-auto">
      <table class="w-full">
        <thead class="bg-gray-50 border-b">
          <tr>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">User Email</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">Requests</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">Total Tokens</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">Cost</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">Successful</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">Failed</th>
          </tr>
        </thead>
        <tbody class="divide-y">
          <% @usage_by_user.each do |stat| %>
            <tr class="hover:bg-gray-50 transition">
              <td class="px-6 py-4 text-sm text-gray-900 font-medium"><%= stat[:user].email %></td>
              <td class="px-6 py-4 text-sm text-gray-600"><%= stat[:request_count] %></td>
              <td class="px-6 py-4 text-sm text-gray-600"><%= number_with_delimiter(stat[:total_tokens]) %></td>
              <td class="px-6 py-4 text-sm text-gray-900 font-medium">$<%= "%.2f" % (stat[:total_cost_cents] / 100.0) %></td>
              <td class="px-6 py-4 text-sm">
                <span class="inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-green-100 text-green-800">
                  <%= stat[:successful] %>
                </span>
              </td>
              <td class="px-6 py-4 text-sm">
                <span class="inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-red-100 text-red-800">
                  <%= stat[:failed] %>
                </span>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Usage by Model -->
  <div class="bg-white rounded-lg shadow overflow-hidden">
    <div class="px-6 py-4 border-b bg-gray-50">
      <h2 class="text-xl font-bold text-gray-900">Usage by Model</h2>
    </div>
    <div class="overflow-x-auto">
      <table class="w-full">
        <thead class="bg-gray-50 border-b">
          <tr>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">Model</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">Provider</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">Requests</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">Total Tokens</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">Cost</th>
          </tr>
        </thead>
        <tbody class="divide-y">
          <% @usage_by_model.each do |stat| %>
            <tr class="hover:bg-gray-50 transition">
              <td class="px-6 py-4 text-sm text-gray-900 font-medium"><%= stat[:model] %></td>
              <td class="px-6 py-4 text-sm text-gray-600"><%= stat[:providers] %></td>
              <td class="px-6 py-4 text-sm text-gray-600"><%= stat[:request_count] %></td>
              <td class="px-6 py-4 text-sm text-gray-600"><%= number_with_delimiter(stat[:total_tokens]) %></td>
              <td class="px-6 py-4 text-sm text-gray-900 font-medium">$<%= "%.2f" % (stat[:total_cost_cents] / 100.0) %></td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Cost Breakdown Grid -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
    <!-- Cost by User -->
    <div class="bg-white rounded-lg shadow overflow-hidden">
      <div class="px-6 py-4 border-b bg-gray-50">
        <h2 class="text-lg font-bold text-gray-900">Cost Breakdown by User</h2>
      </div>
      <div class="divide-y">
        <% @cost_by_user.each do |stat| %>
          <div class="px-6 py-4 flex items-center justify-between hover:bg-gray-50 transition">
            <div class="flex-1">
              <p class="text-sm font-medium text-gray-900"><%= stat[:user_email] %></p>
              <div class="mt-1 w-full bg-gray-200 rounded-full h-2">
                <div class="bg-gradient-to-r from-purple-600 to-pink-600 h-2 rounded-full" style="width: <%= stat[:percentage] %>%"></div>
              </div>
            </div>
            <div class="ml-4 text-right">
              <p class="text-sm font-bold text-gray-900">$<%= "%.2f" % (stat[:cost_cents] / 100.0) %></p>
              <p class="text-xs text-gray-500"><%= stat[:percentage] %>%</p>
            </div>
          </div>
        <% end %>
      </div>
    </div>

    <!-- Cost by Model -->
    <div class="bg-white rounded-lg shadow overflow-hidden">
      <div class="px-6 py-4 border-b bg-gray-50">
        <h2 class="text-lg font-bold text-gray-900">Cost Breakdown by Model</h2>
      </div>
      <div class="divide-y">
        <% @cost_by_model.each do |stat| %>
          <div class="px-6 py-4 flex items-center justify-between hover:bg-gray-50 transition">
            <div class="flex-1">
              <p class="text-sm font-medium text-gray-900"><%= stat[:model] %></p>
              <div class="mt-1 w-full bg-gray-200 rounded-full h-2">
                <div class="bg-gradient-to-r from-blue-600 to-cyan-600 h-2 rounded-full" style="width: <%= stat[:percentage] %>%"></div>
              </div>
            </div>
            <div class="ml-4 text-right">
              <p class="text-sm font-bold text-gray-900">$<%= "%.2f" % (stat[:cost_cents] / 100.0) %></p>
              <p class="text-xs text-gray-500"><%= stat[:percentage] %>%</p>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  </div>

  <% if @llm_requests.empty? %>
    <div class="text-center py-12">
      <p class="text-gray-600">No LLM usage data found</p>
    </div>
  <% end %>
</div>
