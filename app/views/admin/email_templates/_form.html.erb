<%= form_with(model: [:admin, @email_template], local: true, class: "space-y-6") do |form| %>
  <% if @email_template.errors.any? %>
    <div class="bg-red-50 border border-red-200 rounded-lg p-4">
      <h2 class="text-sm font-medium text-red-800 mb-3"><%= pluralize(@email_template.errors.count, "error") %> prohibited this template from being saved:</h2>
      <ul class="space-y-2 text-sm text-red-700">
        <% @email_template.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <!-- Template Name -->
  <div>
    <label for="email_template_name" class="block text-sm font-medium text-gray-700 mb-2">
      Template Name <span class="text-red-500">*</span>
    </label>
    <%= form.text_field :name, placeholder: "e.g., Welcome Email", class: "w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" %>
    <p class="text-xs text-gray-500 mt-1">A unique name to identify this template</p>
  </div>

  <!-- Template Type -->
  <div>
    <label for="email_template_template_type" class="block text-sm font-medium text-gray-700 mb-2">
      Template Type <span class="text-red-500">*</span>
    </label>
    <%= form.select :template_type, EmailTemplate.template_types.keys.map { |k| [k.humanize, k] }, {}, class: "w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" %>
    <p class="text-xs text-gray-500 mt-1">Type of email this template is for</p>
  </div>

  <!-- Subject Line -->
  <div>
    <label for="email_template_subject" class="block text-sm font-medium text-gray-700 mb-2">
      Email Subject <span class="text-red-500">*</span>
    </label>
    <%= form.text_field :subject, placeholder: "Welcome to MediVault, {{user_name}}!", class: "w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" %>
    <p class="text-xs text-gray-500 mt-1">Use {{variable}} for dynamic content</p>
  </div>

  <!-- Available Variables Info -->
  <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
    <h3 class="text-sm font-medium text-blue-900 mb-2">Available Variables</h3>
    <p class="text-xs text-blue-700 mb-2">Use these variables in subject, HTML and text body:</p>
    <ul class="text-xs text-blue-700 space-y-1 ml-3">
      <li><strong>{{user_name}}</strong> - User's full name</li>
      <li><strong>{{email}}</strong> - User's email address</li>
      <li><strong>{{confirmation_link}}</strong> - Email confirmation link</li>
      <li><strong>{{reset_link}}</strong> - Password reset link</li>
      <li><strong>{{support_email}}</strong> - Support email address</li>
    </ul>
  </div>

  <!-- HTML Body -->
  <div>
    <label for="email_template_html_body" class="block text-sm font-medium text-gray-700 mb-2">
      HTML Email Body <span class="text-red-500">*</span>
    </label>
    <%= form.text_area :html_body, placeholder: "<h1>Welcome!</h1>\n<p>Hi {{user_name}},</p>", rows: 12, class: "w-full px-4 py-2 border border-gray-300 rounded-lg font-mono text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent" %>
    <p class="text-xs text-gray-500 mt-1">HTML formatted email content</p>
  </div>

  <!-- Text Body -->
  <div>
    <label for="email_template_text_body" class="block text-sm font-medium text-gray-700 mb-2">
      Plain Text Email Body
    </label>
    <%= form.text_area :text_body, placeholder: "Welcome!\n\nHi {{user_name}},", rows: 8, class: "w-full px-4 py-2 border border-gray-300 rounded-lg font-mono text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent" %>
    <p class="text-xs text-gray-500 mt-1">Plain text alternative for email clients that don't support HTML</p>
  </div>

  <!-- SMS Template Section -->
  <div class="border-t border-gray-200 pt-6">
    <h3 class="text-lg font-semibold text-gray-900 mb-4">SMS Notification (Optional)</h3>

    <div>
      <label for="email_template_sms_body" class="block text-sm font-medium text-gray-700 mb-2">
        SMS Message Body
      </label>
      <%= form.text_area :sms_body,
          placeholder: "Hi {{user_name}}, your credential expires soon. View details: {{link}}",
          rows: 4,
          maxlength: 320,
          class: "w-full px-4 py-2 border border-gray-300 rounded-lg font-mono text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent",
          data: { controller: "character-counter" } %>

      <div class="flex items-center justify-between mt-1">
        <p class="text-xs text-gray-500">SMS message content (keep it short and concise)</p>
        <p class="text-xs text-gray-500" data-character-counter-target="counter">
          <span id="sms-char-count">0</span> / 320 characters
          <span id="sms-message-count" class="ml-2 text-gray-400"></span>
        </p>
      </div>

      <div class="mt-3 bg-yellow-50 border border-yellow-200 rounded-lg p-3">
        <div class="flex gap-2">
          <svg class="w-5 h-5 text-yellow-600 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
          <div class="text-xs text-yellow-800">
            <p class="font-medium mb-1">SMS Best Practices:</p>
            <ul class="list-disc list-inside space-y-1 ml-1">
              <li>Keep under 160 characters for a single SMS (1 message unit)</li>
              <li>160-320 characters will be sent as 2 SMS messages</li>
              <li>Use variables like {{user_name}}, {{link}}, etc.</li>
              <li>SMS is only sent to Pro plan users with verified phone numbers</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Active Status -->
  <div class="flex items-center">
    <label for="email_template_active" class="flex items-center cursor-pointer">
      <%= form.check_box :active, {}, "true", "false" %>
      <span class="ml-3 text-sm font-medium text-gray-700">Active</span>
    </label>
    <p class="text-xs text-gray-500 ml-auto">Only active templates will be used for sending emails</p>
  </div>

  <!-- Form Actions -->
  <div class="flex gap-3 pt-6 border-t border-gray-200">
    <%= form.submit @email_template.persisted? ? "Update Template" : "Create Template", class: "px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition font-medium" %>
    <%= link_to "Cancel", admin_email_templates_path, class: "px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition font-medium" %>
  </div>
<% end %>
