<div class="min-h-screen bg-gray-50 py-8 px-4 sm:px-6 lg:px-8">
  <div class="max-w-4xl mx-auto">
    <!-- Header -->
    <div class="mb-8">
      <h1 class="text-3xl font-bold text-gray-900">Settings</h1>
      <p class="mt-2 text-gray-600">Manage system configuration for API keys, AI models, notifications, and OAuth</p>
    </div>

    <!-- Tabs -->
    <div class="bg-white rounded-lg shadow overflow-hidden">
      <div class="border-b border-gray-200">
        <div class="flex gap-0 px-6" role="tablist">
          <button class="settings-tab active px-4 py-3 text-sm font-medium text-gray-700 border-b-2 border-purple-500 whitespace-nowrap" data-tab="api-keys" role="tab">API Keys</button>
          <button class="settings-tab px-4 py-3 text-sm font-medium text-gray-700 border-b-2 border-transparent hover:text-gray-900 whitespace-nowrap" data-tab="ai-models" role="tab">AI Models</button>
          <button class="settings-tab px-4 py-3 text-sm font-medium text-gray-700 border-b-2 border-transparent hover:text-gray-900 whitespace-nowrap" data-tab="notifications" role="tab">Notifications</button>
          <button class="settings-tab px-4 py-3 text-sm font-medium text-gray-700 border-b-2 border-transparent hover:text-gray-900 whitespace-nowrap" data-tab="oauth" role="tab">OAuth</button>
        </div>
      </div>

      <!-- Tab Content -->
      <div class="p-6">
        <%= form_with url: admin_settings_path, method: :patch, local: true, id: "settings-form", class: "space-y-6" do |f| %>
          <!-- API Keys Tab -->
          <div class="settings-panel active" id="api-keys-panel">
            <h2 class="text-lg font-bold text-gray-900 mb-4">API Keys</h2>

            <div class="space-y-6">
              <!-- NPI API URL -->
              <div>
                <label for="settings_npi_api_url" class="block text-sm font-medium text-gray-700 mb-1">NPI Registry API URL</label>
                <input type="url" name="settings[npi_api_url]" id="settings_npi_api_url" value="<%= @api_settings.find { |s| s.key == 'npi_api_url' }&.value %>" placeholder="https://npiregistry.cms.hhs.gov/api/" class="block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-purple-500 focus:border-purple-500">
                <p class="mt-1 text-sm text-gray-500">The NPI Registry API endpoint for healthcare provider lookups</p>
              </div>
            </div>

            <div class="mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg">
              <p class="text-sm text-blue-700">These are system-wide API keys used for external service integrations.</p>
            </div>
          </div>

          <!-- AI Models Tab -->
          <div class="settings-panel" id="ai-models-panel">
            <h2 class="text-lg font-bold text-gray-900 mb-4">AI Model Configuration</h2>

            <div class="space-y-6">
              <!-- OpenAI Section -->
              <div class="border-l-4 border-blue-500 pl-4">
                <h3 class="font-semibold text-gray-900 mb-4">OpenAI</h3>
                <div class="space-y-4">
                  <div>
                    <label for="settings_openai_api_key" class="block text-sm font-medium text-gray-700 mb-1">API Key</label>
                    <input type="password" name="settings[openai_api_key]" id="settings_openai_api_key" placeholder="sk-..." class="block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-purple-500 focus:border-purple-500">
                    <p class="mt-1 text-sm text-gray-500">Your OpenAI API key (leave blank to keep current)</p>
                  </div>
                  <div>
                    <label for="settings_openai_model" class="block text-sm font-medium text-gray-700 mb-1">Default Model</label>
                    <select name="settings[openai_model]" id="settings_openai_model" class="block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-purple-500 focus:border-purple-500">
                      <%
                        current_model = @api_settings.find { |s| s.key == 'openai_model' }&.value || 'gpt-4o'
                        openai_models = [
                          ['GPT-4o (Latest, Multimodal)', 'gpt-4o'],
                          ['GPT-4o Mini (Fast & Cost-effective)', 'gpt-4o-mini'],
                          ['GPT-4 Turbo (128K context)', 'gpt-4-turbo'],
                          ['GPT-4 Turbo (With Vision)', 'gpt-4-turbo-2024-04-09'],
                          ['GPT-4 (8K context)', 'gpt-4'],
                          ['GPT-4 (32K context)', 'gpt-4-32k'],
                          ['GPT-3.5 Turbo (Fast & Affordable)', 'gpt-3.5-turbo'],
                          ['GPT-3.5 Turbo (16K context)', 'gpt-3.5-turbo-16k'],
                          ['O1 Preview (Advanced Reasoning)', 'o1-preview'],
                          ['O1 Mini (Fast Reasoning)', 'o1-mini']
                        ]
                      %>
                      <% openai_models.each do |label, value| %>
                        <option value="<%= value %>" <%= 'selected' if current_model == value %>><%= label %></option>
                      <% end %>
                    </select>
                    <p class="mt-1 text-sm text-gray-500">Select the OpenAI model to use for credential extraction and analysis</p>
                  </div>
                </div>
              </div>

              <!-- Ollama Section -->
              <div class="border-l-4 border-orange-500 pl-4">
                <h3 class="font-semibold text-gray-900 mb-4">Ollama (Local LLM)</h3>
                <div class="space-y-4">
                  <div>
                    <label for="settings_ollama_url" class="block text-sm font-medium text-gray-700 mb-1">API URL</label>
                    <input type="url" name="settings[ollama_url]" id="settings_ollama_url" value="<%= @api_settings.find { |s| s.key == 'ollama_url' }&.value %>" placeholder="http://localhost:11434" class="block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-purple-500 focus:border-purple-500">
                    <p class="mt-1 text-sm text-gray-500">Local Ollama server endpoint</p>
                  </div>
                  <div>
                    <label for="settings_ollama_model" class="block text-sm font-medium text-gray-700 mb-1">Model Name</label>
                    <input type="text" name="settings[ollama_model]" id="settings_ollama_model" value="<%= @api_settings.find { |s| s.key == 'ollama_model' }&.value %>" placeholder="mistral" class="block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-purple-500 focus:border-purple-500">
                    <p class="mt-1 text-sm text-gray-500">Ollama model to use (e.g., mistral, neural-chat)</p>
                  </div>
                </div>
              </div>
            </div>

            <div class="mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg">
              <p class="text-sm text-blue-700">Configure which LLM backend to use for credential extraction and analysis.</p>
            </div>
          </div>

          <!-- Notifications Tab -->
          <div class="settings-panel" id="notifications-panel">
            <h2 class="text-lg font-bold text-gray-900 mb-4">Notification Services</h2>

            <div class="space-y-6">
              <!-- Twilio Section -->
              <div class="border-l-4 border-red-500 pl-4">
                <h3 class="font-semibold text-gray-900 mb-4">Twilio (SMS)</h3>
                <div class="space-y-4">
                  <div>
                    <label for="settings_twilio_sid" class="block text-sm font-medium text-gray-700 mb-1">Account SID</label>
                    <input type="text" name="settings[twilio_sid]" id="settings_twilio_sid" value="<%= @api_settings.find { |s| s.key == 'twilio_sid' }&.value %>" placeholder="ACxxxxxxxxxx" class="block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-purple-500 focus:border-purple-500">
                  </div>
                  <div>
                    <label for="settings_twilio_token" class="block text-sm font-medium text-gray-700 mb-1">Auth Token</label>
                    <input type="password" name="settings[twilio_token]" id="settings_twilio_token" placeholder="Your auth token" class="block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-purple-500 focus:border-purple-500">
                    <p class="mt-1 text-sm text-gray-500">Leave blank to keep current (leave blank to keep current)</p>
                  </div>
                  <div>
                    <label for="settings_twilio_from" class="block text-sm font-medium text-gray-700 mb-1">From Number</label>
                    <input type="tel" name="settings[twilio_from]" id="settings_twilio_from" value="<%= @api_settings.find { |s| s.key == 'twilio_from' }&.value %>" placeholder="+1234567890" class="block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-purple-500 focus:border-purple-500">
                    <p class="mt-1 text-sm text-gray-500">Phone number SMS alerts will be sent from</p>
                  </div>
                </div>
              </div>

              <!-- SMTP Section -->
              <div class="border-l-4 border-green-500 pl-4">
                <h3 class="font-semibold text-gray-900 mb-4">SMTP (Email)</h3>
                <div class="space-y-4">
                  <div>
                    <label for="settings_smtp_host" class="block text-sm font-medium text-gray-700 mb-1">SMTP Host</label>
                    <input type="text" name="settings[smtp_host]" id="settings_smtp_host" value="<%= @api_settings.find { |s| s.key == 'smtp_host' }&.value %>" placeholder="smtp.gmail.com" class="block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-purple-500 focus:border-purple-500">
                  </div>
                  <div class="grid grid-cols-2 gap-4">
                    <div>
                      <label for="settings_smtp_port" class="block text-sm font-medium text-gray-700 mb-1">Port</label>
                      <input type="number" name="settings[smtp_port]" id="settings_smtp_port" value="<%= @api_settings.find { |s| s.key == 'smtp_port' }&.value %>" placeholder="587" class="block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-purple-500 focus:border-purple-500">
                    </div>
                    <div>
                      <label for="settings_smtp_username" class="block text-sm font-medium text-gray-700 mb-1">Username</label>
                      <input type="text" name="settings[smtp_username]" id="settings_smtp_username" value="<%= @api_settings.find { |s| s.key == 'smtp_username' }&.value %>" placeholder="your-email@gmail.com" class="block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-purple-500 focus:border-purple-500">
                    </div>
                  </div>
                  <div>
                    <label for="settings_smtp_password" class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                    <input type="password" name="settings[smtp_password]" id="settings_smtp_password" placeholder="Your SMTP password" class="block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-purple-500 focus:border-purple-500">
                    <p class="mt-1 text-sm text-gray-500">Leave blank to keep current</p>
                  </div>
                </div>
              </div>
            </div>

            <div class="mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg">
              <p class="text-sm text-blue-700">Configure how the system sends SMS and email notifications to users.</p>
            </div>
          </div>

          <!-- OAuth Tab -->
          <div class="settings-panel" id="oauth-panel">
            <h2 class="text-lg font-bold text-gray-900 mb-4">OAuth Configuration</h2>

            <div class="space-y-6">
              <!-- Google OAuth Section -->
              <div class="border-l-4 border-yellow-500 pl-4">
                <h3 class="font-semibold text-gray-900 mb-4">Google OAuth</h3>
                <p class="text-sm text-gray-600 mb-4">Configure Google OAuth for user authentication and profile access.</p>
                <div class="space-y-4">
                  <div>
                    <label for="settings_google_oauth_client_id" class="block text-sm font-medium text-gray-700 mb-1">Client ID</label>
                    <input type="text" name="settings[google_oauth_client_id]" id="settings_google_oauth_client_id" value="<%= @api_settings.find { |s| s.key == 'google_oauth_client_id' }&.value %>" placeholder="xxx.apps.googleusercontent.com" class="block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-purple-500 focus:border-purple-500">
                  </div>
                  <div>
                    <label for="settings_google_oauth_client_secret" class="block text-sm font-medium text-gray-700 mb-1">Client Secret</label>
                    <input type="password" name="settings[google_oauth_client_secret]" id="settings_google_oauth_client_secret" placeholder="Your client secret" class="block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-purple-500 focus:border-purple-500">
                    <p class="mt-1 text-sm text-gray-500">Leave blank to keep current</p>
                  </div>
                  <div>
                    <label for="settings_google_oauth_redirect_uri" class="block text-sm font-medium text-gray-700 mb-1">Redirect URI</label>
                    <input type="url" name="settings[google_oauth_redirect_uri]" id="settings_google_oauth_redirect_uri" value="<%= @api_settings.find { |s| s.key == 'google_oauth_redirect_uri' }&.value %>" placeholder="https://your-domain.com/auth/google/callback" class="block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-purple-500 focus:border-purple-500">
                    <p class="mt-1 text-sm text-gray-500">Must match the URI configured in Google Console</p>
                  </div>
                </div>
              </div>
            </div>

            <div class="mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg">
              <p class="text-sm text-blue-700">Configure third-party OAuth providers for user authentication.</p>
            </div>
          </div>

          <!-- Form Actions -->
          <div class="flex gap-3 pt-6 border-t border-gray-200 sticky bottom-0 bg-white">
            <%= f.submit "Save Settings", class: "inline-flex items-center px-4 py-2 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white bg-purple-600 hover:bg-purple-700 transition-colors" %>
            <%= link_to "Cancel", admin_root_path, class: "inline-flex items-center px-4 py-2 border border-gray-300 rounded-lg shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 transition-colors" %>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>

<script>
  document.querySelectorAll('.settings-tab').forEach(tab => {
    tab.addEventListener('click', function() {
      const tabName = this.dataset.tab;

      // Hide all panels
      document.querySelectorAll('.settings-panel').forEach(panel => {
        panel.classList.remove('active');
      });

      // Remove active state from all tabs
      document.querySelectorAll('.settings-tab').forEach(t => {
        t.classList.remove('active');
        t.style.borderBottomColor = 'transparent';
      });

      // Show selected panel
      document.getElementById(tabName + '-panel').classList.add('active');

      // Set active state on tab
      this.classList.add('active');
      this.style.borderBottomColor = '#a855f7';
    });
  });
</script>

<style>
  .settings-panel {
    display: none;
  }

  .settings-panel.active {
    display: block;
  }
</style>
